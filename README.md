# 🏁 B城赛马自动化脚本 - 青龙面板版

一个专门为青龙面板设计的B城赛马网站自动化下注脚本，支持智能下注策略、随机延迟启动、丰富的配置选项和完整的执行日志。


## 🌟 主要特性

- 🎯 **智能下注策略** - 基于奖池金额和用户余额的智能判断
- ⏰ **随机延迟启动** - 3-12分钟随机延迟，避免批量执行被检测
- 🎲 **随机选号** - 智能避重的随机马匹号码选择（1-24）
- 📊 **丰富的配置选项** - 支持多种环境变量自定义配置
- 🔍 **详细执行日志** - 完整的执行过程和结果统计
- 🛡️ **安全防护** - 内置超时机制和错误处理
- 📱 **青龙面板完美适配** - 专为青龙面板设计的日志格式

## 📋 功能说明

### 核心执行流程

1. **获取当前比赛信息** - 检查比赛状态和奖池金额
2. **获取核心数据** - 验证用户余额和下注条件
3. **执行智能下注** - 根据配置进行随机选号下注
4. **获取最终统计** - 显示下注结果和余额变化

### 智能策略

- **奖池过滤** - 只在奖池达到设定金额时执行
- **余额保护** - 自动检查余额是否满足最低要求
- **避重选号** - 智能避免重复选择相同马匹号码
- **随机延迟** - 防止批量脚本同时执行被识别

## ⚙️ 环境变量配置

| 变量名 | 是否必需 | 默认值 | 说明 |
|-------|---------|--------|------|
| `HORSE_RACING_COOKIE` | ✅ 必需 | 无 | 登录Cookie，用于身份验证 |
| `MIN_PRIZE_POOL` | ⭕ 可选 | `50000` | 最小奖池金额，低于此值不执行 |
| `MIN_BALANCE` | ⭕ 可选 | `3000` | 最小余额要求，低于此值停止下注 |
| `MAX_BETS` | ⭕ 可选 | `3` | 单次执行最大下注次数 |
| `ENABLE_DELAY` | ⭕ 可选 | `true` `false` | 是否启用3-12分钟随机延迟启动 |

## 🚀 青龙面板安装使用

### 方式一：一键订阅（推荐）

1. 登录青龙面板
2. 进入 `脚本管理` → `订阅管理`
3. 点击 `新建订阅`
4. 填入以下信息：
   - **名称**: `B城赛马自动化`
   - **类型**: `公开仓库`
   - **链接**: `https://github.com/DeakinNeal/BCity_horse.git`
   - **定时规则**: `5,25,45 7-23 * * *`
   - **白名单**: `horse_racing_ql.js`

5. 点击 `确定` 完成订阅

### 方式二：手动下载

1. 下载 `horse_racing_ql.js` 文件
2. 上传到青龙面板的 `scripts` 目录
3. 在 `定时任务` 中添加任务

### 环境变量设置

1. 进入青龙面板 `环境变量` 页面
2. 添加以下必需变量：

```bash
# 必需配置
HORSE_RACING_COOKIE="your_cookie_here"

# 可选配置（根据需要设置）
MIN_PRIZE_POOL="50000"
MIN_BALANCE="3000" 
MAX_BETS="3"
ENABLE_DELAY="true"
```

### 获取Cookie方法

1. 打开浏览器访问B城赛马网站并登录
2. 按 `F12` 打开开发者工具
3. 切换到 `Network` 标签页
4. 刷新页面或进行任何操作
5. 找到请求头中的 `Cookie` 值并复制
6. 将完整的Cookie值设置到 `HORSE_RACING_COOKIE` 环境变量

## 📅 执行时间设置

### 推荐Cron表达式

```bash
# 每天7点-23点的5，25，45分执行
5,25,45 7-23 * * *
```

## 📊 执行日志示例

```
🏁 马匹竞赛自动化脚本 - 青龙面板版
⚙️ 配置信息:
   最小奖池: 50000
   最小余额: 3000
   最大下注: 3
   随机延迟: 启用(3-12分钟)
================================

🚀 马匹竞赛自动化脚本启动
⏰ 脚本启动时间: 2025/1/15 14:25:03
⏳ 随机延迟启动: 8.5分钟 (510000ms)
🕐 预计执行时间: 2025/1/15 14:33:33

🏁 步骤1: 获取当前比赛信息
🏆 比赛信息: 第128场赛马比赛 (ID: 128)
💰 奖池金额: 68500
⏰ 比赛时间: 2025-01-15 14:35:00
📊 比赛状态: 下注中
✅ 奖池金额 68500 >= 50000，继续执行

📊 步骤2: 获取核心数据
💳 用户余额: 5280
✅ 用户余额 5280 > 3000，继续执行下注

🎯 步骤3: 执行下注（最多3次）
🎲 第1次下注:
🐎 选择马匹号码: 15
✅ 下注成功！
💰 新余额: 5180

🎊 ===== 最终用户统计信息 =====
💳 当前余额: 5180
🎯 总计下注: 245
💰 总计投入: 24500
🏆 总计赢取: 29680
🎉 获胜次数: 89
================================

✅ 自动化脚本执行完成
⏰ 脚本结束时间: 2025/1/15 14:34:28
⌛ 总耗时(含延迟): 563秒 (563000ms)
⚡ 实际执行耗时: 53秒 (53000ms)
```

## 🔧 系统要求

- **Node.js版本**: >= 18.0.0 (支持内置fetch API)
- **青龙面板**: 支持所有版本
- **网络环境**: 需要访问B城网站

## 📋 注意事项

### ⚠️ 重要提醒

- 本脚本仅供学习和研究使用
- 请遵守相关网站的使用条款
- 合理设置下注金额，注意风险控制
- 定期检查Cookie有效性
- 建议设置合理的执行时间间隔

### 🐛 常见问题

**Q: 脚本执行失败显示Cookie无效？**  
A: Cookie可能已过期，需要重新获取并更新环境变量

**Q: 为什么脚本不执行下注？**  
A: 检查奖池金额和用户余额是否满足设置的最低要求

**Q: 如何关闭随机延迟？**  
A: 设置环境变量 `ENABLE_DELAY=false`

**Q: 脚本报错"不支持fetch API"？**  
A: 升级Node.js到18.0.0以上版本

## 🔄 版本更新

- **v1.0.0**: 初始版本发布
- 支持基础的自动下注功能
- 集成青龙面板环境变量配置
- 添加随机延迟和智能策略

## 📖 青龙面板相关资源

- **青龙面板官方仓库**: [https://github.com/whyour/qinglong](https://github.com/whyour/qinglong)
- **安装教程**: [青龙面板部署指南](https://github.com/whyour/qinglong/blob/master/README.md)
- **Docker安装**: `docker run -dit -v $PWD/ql:/ql/data -p 5700:5700 whyour/qinglong:latest`


## 🤝 贡献

欢迎提交 Issues 和 Pull Requests 来帮助改进这个项目！

## ⭐ 支持项目

如果这个脚本对你有帮助，欢迎给项目点个星星 ⭐

---

**免责声明**: 本脚本仅供学习交流使用，使用者需自行承担使用风险。作者不对使用本脚本造成的任何损失承担责任。
